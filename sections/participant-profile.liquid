{% comment %}
Participant Profile (Blocks)
- Shows pieces of the Participant metaobject as configurable blocks.
- Reorder/enable blocks in the Theme Editor.
- Uses metafield_tag to render rich text JSON.

Metaobject fields available:
  - company_name (text)
  - company_about (rich text)
  - company_description (rich text)
  - profile_description (rich text)
  - profile_document (file)
  - company_contact (rich text or text)
{% endcomment %}

<section class="participant-profile-logo" id="participant-profile-logo">

    {%- comment -%} Logo (metaobject: participants.company_logo) {%- endcomment -%}
    {% if metaobject.company_logo %}
      <div class="participant-logo">
        <img
          src="{{ metaobject.company_logo | image_url: width: section.settings.logo_max_width | default: 320 }}"
          alt="{{ metaobject.company_name | default: 'Participant' | escape }}"
          width="{{ section.settings.logo_max_width }}"
          loading="lazy"
        >
      </div>
    {% endif %}

</section>

<section class="page-width" id="participant-profile">

  <header class="section-header participant-header">

    {%- comment -%} Breadcrumbs {%- endcomment -%}
    {% if section.settings.show_breadcrumbs %}
      <nav class="breadcrumbs" aria-label="Breadcrumb">
        {% assign crumb_label = section.settings.breadcrumb_label | default: 'Circle of Care' %}
        {% if section.settings.breadcrumb_url != blank %}
          <a href="{{ section.settings.breadcrumb_url }}">{{ crumb_label }}</a>
        {% else %}
          <span>{{ crumb_label }}</span>
        {% endif %}
        <span class="breadcrumbs__sep" aria-hidden="true">â€º</span>
        <span class="breadcrumbs__current">
          {{ metaobject.company_name | default: 'Participant' }}
        </span>
      </nav>
    {% endif %}

    {% if section.settings.show_title %}
        <header class="section-header">
        <h1 class="h1">{{ metaobject.company_name | default: 'Participant' }}</h1>
        </header>
    {% endif %}
  </header>

  <div class="profile-blocks">
    {% for block in section.blocks %}
      {% case block.type %}
        {% when 'about' %}
          {% if metaobject.company_about %}
            <div class="profile-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_heading %}
                <{{ block.settings.heading_tag }} class="h3">{{ block.settings.heading | default: 'About the Company' }}</{{ block.settings.heading_tag }}>
              {% endif %}
              <div class="rte">{{ metaobject.company_about | metafield_tag }}</div>
            </div>
          {% endif %}

        {% when 'company_description' %}
          {% if metaobject.company_description %}
            <div class="profile-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_heading %}
                <{{ block.settings.heading_tag }} class="h3">{{ block.settings.heading | default: 'Company Description' }}</{{ block.settings.heading_tag }}>
              {% endif %}
              <div class="rte">{{ metaobject.company_description | metafield_tag }}</div>
            </div>
          {% endif %}

        {% when 'profile_description' %}
          {% if metaobject.profile_description %}
            <div class="profile-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_heading %}
                <{{ block.settings.heading_tag }} class="h3">{{ block.settings.heading | default: 'Profile Description' }}</{{ block.settings.heading_tag }}>
              {% endif %}
              <div class="rte">{{ metaobject.profile_description | metafield_tag }}</div>
            </div>
          {% endif %}

        {% when 'contact' %}
          {% if metaobject.company_contact %}
            <div class="profile-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_heading %}
                <{{ block.settings.heading_tag }} class="h3">{{ block.settings.heading | default: 'Contact Information' }}</{{ block.settings.heading_tag }}>
              {% endif %}
              {%- comment -%}
              If contact is plain text, switch to: {{ metaobject.company_contact | escape | newline_to_br }}
              {%- endcomment -%}
              <div class="rte">{{ metaobject.company_contact | metafield_tag }}</div>
            </div>
          {% endif %}

        {% when 'document' %}
          {% assign doc = metaobject.profile_document %}
          {% if doc and doc != blank %}
            {% assign doc_url = doc.url | default: doc.preview_image.src %}
            <div class="profile-block" {{ block.shopify_attributes }}>
              {% if block.settings.show_heading %}
                <{{ block.settings.heading_tag }} class="h3">{{ block.settings.heading | default: 'Profile Document' }}</{{ block.settings.heading_tag }}>
              {% endif %}
              <p>
                <a href="{{ doc_url }}" download target="_blank" rel="noopener">
                  {{ block.settings.link_label | default: doc.filename | default: 'Download profile document' }}
                </a>
              </p>
            </div>
          {% endif %}
      {% endcase %}

      {% if block.settings.show_divider %}
        <hr class="profile-divider">
      {% endif %}
    {% endfor %}
  </div>
</section>

<style>
    #participant-profile {
        width:850px;
        max-width:100%;
        padding:4rem 0;
    }
    #participant-profile .profile-block + .profile-block {
        margin-top: 2rem;
    }
    #participant-profile .profile-divider {
        margin: 1.5rem 0;
    }
    #participant-profile .participant-header {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    #participant-profile .participant-header {
        
    }
    #participant-profile .participant-logo img {
        max-width: 100%;   
        height: auto;
        display: block;
    }
    #participant-profile .breadcrumbs {
        font-size: 14px;
        opacity: 0.85;
    }
    #participant-profile .breadcrumbs a {
        text-decoration: none;
    }
    #participant-profile .breadcrumbs__current {
        color:#63308A;
        font-weight:800;
    }
    #participant-profile .breadcrumbs__sep {
        margin: 0 0.4rem;
    }
    #participant-profile .participant-title {
        margin: 0.25rem 0 0;
    }
    .participant-profile-logo {
        background:#63308A;
        height:280px;
        display:flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius:180px 0 0 0;
    }
    .participant-profile-logo img {
        width:320px;
        height:auto;
    }
</style>

{% schema %}
{
  "name": "Participant Profile",
  "settings": [
    {
        "type": "checkbox",
        "id": "show_title",
        "label": "Show company name as title",
        "default": true
    },
    {
        "type": "header",
        "content": "Header options"
    },
    {
        "type": "range",
        "id": "logo_max_width",
        "label": "Logo max width (px)",
        "min": 80, "max": 600, "step": 10,
        "default": 220
    },
    {
        "type": "checkbox",
        "id": "show_breadcrumbs",
        "label": "Show breadcrumbs",
        "default": true
    },
    {
        "type": "text",
        "id": "breadcrumb_label",
        "label": "Breadcrumb root label",
        "default": "Circle of Care"
    },
    {
        "type": "url",
        "id": "breadcrumb_url",
        "label": "Breadcrumb root link (e.g., /pages/participants)"
    }
  ],
  "blocks": [
    {
      "type": "about",
      "name": "About block",
      "limit": 1,
      "settings": [
        { "type": "checkbox", "id": "show_heading", "label": "Show heading", "default": true },
        { "type": "text", "id": "heading", "label": "Heading text", "default": "About the Company" },
        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h2", "label": "H2" }, { "value": "h3", "label": "H3" }, { "value": "h4", "label": "H4" }
        ]},
        { "type": "checkbox", "id": "show_divider", "label": "Show divider below", "default": false }
      ]
    },
    {
      "type": "company_description",
      "name": "Company description block",
      "settings": [
        { "type": "checkbox", "id": "show_heading", "label": "Show heading", "default": true },
        { "type": "text", "id": "heading", "label": "Heading text", "default": "Company Description" },
        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h2", "label": "H2" }, { "value": "h3", "label": "H3" }, { "value": "h4", "label": "H4" }
        ]},
        { "type": "checkbox", "id": "show_divider", "label": "Show divider below", "default": false }
      ]
    },
    {
      "type": "profile_description",
      "name": "Profile description block",
      "settings": [
        { "type": "checkbox", "id": "show_heading", "label": "Show heading", "default": true },
        { "type": "text", "id": "heading", "label": "Heading text", "default": "Profile Description" },
        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h2", "label": "H2" }, { "value": "h3", "label": "H3" }, { "value": "h4", "label": "H4" }
        ]},
        { "type": "checkbox", "id": "show_divider", "label": "Show divider below", "default": false }
      ]
    },
    {
      "type": "contact",
      "name": "Contact info block",
      "settings": [
        { "type": "checkbox", "id": "show_heading", "label": "Show heading", "default": true },
        { "type": "text", "id": "heading", "label": "Heading text", "default": "Contact Information" },
        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h2", "label": "H2" }, { "value": "h3", "label": "H3" }, { "value": "h4", "label": "H4" }
        ]},
        { "type": "checkbox", "id": "show_divider", "label": "Show divider below", "default": false }
      ]
    },
    {
      "type": "document",
      "name": "Profile document block",
      "settings": [
        { "type": "checkbox", "id": "show_heading", "label": "Show heading", "default": true },
        { "type": "text", "id": "heading", "label": "Heading text", "default": "Profile Document" },
        { "type": "select", "id": "heading_tag", "label": "Heading tag", "default": "h2", "options": [
          { "value": "h2", "label": "H2" }, { "value": "h3", "label": "H3" }, { "value": "h4", "label": "H4" }
        ]},
        { "type": "text", "id": "link_label", "label": "Link label (optional)", "default": "Download profile document" },
        { "type": "checkbox", "id": "show_divider", "label": "Show divider below", "default": false }
      ]
    }
  ],
  "presets": [
    {
      "name": "Participant Profile",
      "blocks": [
        { "type": "about" },
        { "type": "company_description" },
        { "type": "profile_description" },
        { "type": "contact" },
        { "type": "document" }
      ]
    }
  ]
}
{% endschema %}
