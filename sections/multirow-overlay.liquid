{{ 'component-image-with-text.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Ensure the overlay sits above the image */
  .image-with-text__media { position: relative; }
  .image-with-text__media img { display:block; width:100%; height:auto; }

  .iwt-overlay {
    position: absolute;
    inset: 0;
    z-index: 2; /* key: overlay above image */
    display: flex;
    flex-direction: column;
    justify-content: flex-end; /* default bottom */
    gap: .25rem;
    padding: 16px;
    pointer-events: none; /* clicks pass through */
    background: linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,0));
    color: #fff;
  }
  .iwt-overlay--top    { justify-content: flex-start; }
  .iwt-overlay--center { justify-content: center; }
  .iwt-overlay__caption {
    margin: 0;
    font-size: 12px;
    letter-spacing: .08em;
    text-transform: uppercase;
    opacity: .9;
  }
  .iwt-overlay__heading { margin: 0; }

  @media screen and (min-width: 750px){
    .iwt-overlay { padding: 20px; }
    .iwt-overlay__caption { font-size: 13px; }
  }
{%- endstyle -%}

{%- liquid
  if section.settings.image_layout contains 'right'
    assign odd_class = ' image-with-text__grid--reverse'
  else
    assign even_class = ' image-with-text__grid--reverse'
  endif

  if section.settings.row_color_scheme == section.settings.section_color_scheme
    assign no_content_background = true
  endif

  if settings.text_boxes_shadow_opacity == 0 and settings.text_boxes_border_thickness == 0 or settings.text_boxes_border_opacity == 0
    assign no_content_styles = true
  endif

  if settings.text_boxes_border_thickness > 0 and settings.text_boxes_border_opacity > 0 and settings.media_border_thickness > 0 and settings.media_border_opacity > 0
    assign borders_class = ' collapse-borders'
  endif

  if no_content_background and no_content_styles
    assign padding_class = ' collapse-padding'
  endif

  unless no_content_background and no_content_styles
    assign corners_class = ' collapse-corners'
  endunless
-%}

<div class="multirow section-{{ section.id }}-padding gradient color-{{ section.settings.section_color_scheme }}">
  <div class="multirow__inner page-width">
    {%- for block in section.blocks -%}
      <div class="image-with-text isolate{{ borders_class }}{{ corners_class }}{{ padding_class }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
           {{ block.shopify_attributes }}>
        <div class="image-with-text__grid grid grid--gapless grid--1-col grid--{% if section.settings.desktop_image_width == 'medium' %}2-col-tablet{% else %}3-col-tablet{% endif %}{% if section.settings.image_layout contains 'alternate' %}{% cycle odd_class, even_class %}{% else %}{{ odd_class }}{% endif %}">

          <!-- Media column with overlay -->
          <div class="image-with-text__media-item image-with-text__media-item--{{ section.settings.desktop_image_width }} image-with-text__media-item--{{ section.settings.desktop_content_position }} grid__item">
            <div class="image-with-text__media image-with-text__media--{{ section.settings.image_height }} gradient color-{{ section.settings.row_color_scheme }} global-media-settings{% if block.settings.image != blank %} media{% else %} image-with-text__media--placeholder placeholder{% endif %}"
                 {% if section.settings.image_height == 'adapt' and block.settings.image != blank %}
                   style="padding-bottom: {{ 1 | divided_by: block.settings.image.aspect_ratio | times: 100 }}%;"
                 {% endif %}>
              {%- if block.settings.image != blank -%}
                {%- capture sizes -%}
                  (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: 2 }}px,
                  (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)
                {%- endcapture -%}
                {{
                  block.settings.image
                  | image_url: width: 1500
                  | image_tag: sizes: sizes, widths: '165, 360, 535, 750, 1070, 1500'
                }}
              {%- else -%}
                {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}

              {%- if block.settings.caption != blank or block.settings.heading != blank -%}
                <div class="iwt-overlay iwt-overlay--{{ section.settings.overlay_vertical }}">
                  {%- if block.settings.caption != blank -%}
                    <p class="iwt-overlay__caption">{{ block.settings.caption | escape }}</p>
                  {%- endif -%}
                  {%- if block.settings.heading != blank -%}
                    <h2 class="iwt-overlay__heading {{ section.settings.heading_size }} rte">{{ block.settings.heading }}</h2>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
          </div>

          <!-- Text column -->
          <div class="image-with-text__text-item grid__item">
            <div class="image-with-text__content image-with-text__content--{{ section.settings.desktop_content_position }} image-with-text__content--desktop-{{ section.settings.desktop_content_alignment }} image-with-text__content--mobile-{{ section.settings.mobile_content_alignment }} image-with-text__content--{{ section.settings.image_height }} content-container{% unless no_content_background and no_content_styles %} gradient color-{{ section.settings.row_color_scheme }}{% else %} background-transparent{% endunless %}">
              {%- if block.settings.text -%}
                <div class="image-with-text__text rte {{ section.settings.text_style }}">{{ block.settings.text }}</div>
              {%- endif -%}
              {%- if block.settings.button_label != blank -%}
                <a {% if block.settings.button_link == blank %} role="link" aria-disabled="true" {% else %} href="{{ block.settings.button_link }}" {% endif %} class="button button--{{ section.settings.button_style }}">
                  {{ block.settings.button_label | escape }}
                </a>
              {%- endif -%}
            </div>
          </div>

        </div>
      </div>
    {%- endfor -%}
  </div>
</div>

{% schema %}
{
  "name": "Multirow (Overlay)",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "header", "content": "Overlay image-with-text rows" },

    { "type": "select", "id": "image_height", "label": "Image height",
      "options": [
        { "value": "adapt",  "label": "Adapt to image" },
        { "value": "small",  "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large",  "label": "Large" }
      ],
      "default": "medium"
    },

    { "type": "select", "id": "desktop_image_width", "label": "Desktop image width",
      "options": [
        { "value": "small",  "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large",  "label": "Large" }
      ],
      "default": "medium"
    },

    { "type": "select", "id": "image_layout", "label": "Image layout",
      "options": [
        { "value": "alternate-left",  "label": "Alternate (start left)" },
        { "value": "alternate-right", "label": "Alternate (start right)" },
        { "value": "align-left",      "label": "Always left" },
        { "value": "align-right",     "label": "Always right" }
      ],
      "default": "alternate-left"
    },

    { "type": "select", "id": "overlay_vertical", "label": "Overlay vertical position",
      "options": [
        { "value": "top",    "label": "Top" },
        { "value": "center", "label": "Center" },
        { "value": "bottom", "label": "Bottom" }
      ],
      "default": "bottom"
    },

    { "type": "header", "content": "Text styles" },
    { "type": "select", "id": "heading_size", "label": "Heading size",
      "options": [
        { "value": "h2",  "label": "H2" },
        { "value": "h1",  "label": "H1" },
        { "value": "h0",  "label": "H0" },
        { "value": "hxl", "label": "HXL" },
        { "value": "hxxl","label": "HXXL" }
      ],
      "default": "h1"
    },

    { "type": "select", "id": "text_style", "label": "Body text style",
      "options": [
        { "value": "body",     "label": "Body" },
        { "value": "subtitle", "label": "Subtitle" }
      ],
      "default": "body"
    },

    { "type": "select", "id": "button_style", "label": "Button style",
      "options": [
        { "value": "primary",   "label": "Primary" },
        { "value": "secondary", "label": "Secondary" }
      ],
      "default": "secondary"
    },

    { "type": "select", "id": "desktop_content_position", "label": "Content vertical align",
      "options": [
        { "value": "top",    "label": "Top" },
        { "value": "middle", "label": "Middle" },
        { "value": "bottom", "label": "Bottom" }
      ],
      "default": "middle"
    },

    { "type": "select", "id": "desktop_content_alignment", "label": "Content horizontal align (desktop)",
      "options": [
        { "value": "left",   "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right",  "label": "Right" }
      ],
      "default": "left"
    },

    { "type": "select", "id": "mobile_content_alignment", "label": "Content horizontal align (mobile)",
      "options": [
        { "value": "left",   "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right",  "label": "Right" }
      ],
      "default": "left"
    },

    { "type": "header", "content": "Colors" },
    { "type": "color_scheme", "id": "section_color_scheme", "label": "Section color scheme", "default": "scheme-1" },
    { "type": "color_scheme", "id": "row_color_scheme",     "label": "Row color scheme",     "default": "scheme-1" },

    { "type": "header", "content": "Section padding" },
    { "type": "range", "id": "padding_top",    "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top padding",    "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom padding", "default": 36 }
  ],

  "blocks": [
    {
      "type": "row",
      "name": "Row",
      "settings": [
        { "type": "image_picker",     "id": "image",        "label": "Image" },
        { "type": "text",             "id": "caption",      "label": "Caption", "default": "Your caption" },
        { "type": "inline_richtext",  "id": "heading",      "label": "Heading", "default": "Your heading" },
        { "type": "richtext",         "id": "text",         "label": "Body text", "default": "<p>Add descriptive text here.</p>" },
        { "type": "text",             "id": "button_label", "label": "Button label", "default": "Learn more", "info": "Leave empty to hide the button" },
        { "type": "url",              "id": "button_link",  "label": "Button link" }
      ]
    }
  ],

  "presets": [
    {
      "name": "Multirow (Overlay)",
      "blocks": [
        { "type": "row" },
        { "type": "row" },
        { "type": "row" }
      ]
    }
  ]
}
{% endschema %}
